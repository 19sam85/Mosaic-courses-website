server {
    listen 80;
    server_tokens off;
    # server_name tessera.hopto.org;
    error_log /var/log/nginx/error.log debug;
    
    location / {
      # index  index.html index.htm;
      # try_files $uri /index.html;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      alias /staticfiles/;
    }

    location /api/ {
      # Это и есть нужная строка:
      # при перенаправлении запроса в контейнер backend
      # подменить адрес "backend" в заголовке запроса 
      # на тот адрес, который пользователь ввёл в браузере
      proxy_set_header Host $http_host;
      proxy_pass http://web:8000/api/;
    }
    location /admin/ {
      # И в этом блоке то же самое:
      proxy_set_header Host $http_host;
      proxy_pass http://web:8000/admin/;
    }

    location /media/ {
      # proxy_set_header Host $http_host;
      alias /app/media/;
      index index.html;
      # proxy_pass http://web:8000/media/;
    }
      
    #   location @proxy_api {
    #     proxy_set_header X-Forwarded-Proto https;
    #     proxy_set_header X-Url-Scheme $scheme;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header Host $http_host;
    #     proxy_redirect off;
    #     proxy_pass http://web:8000;
    # }

}


  # location /api/ {
  #   # Это и есть нужная строка:
  #   # при перенаправлении запроса в контейнер backend
  #   # подменить адрес "backend" в заголовке запроса 
  #   # на тот адрес, который пользователь ввёл в браузере
  #   proxy_set_header Host $http_host;
  #   proxy_pass http://backend:8000/api/;
  # }
  # location /admin/ {
  #   # И в этом блоке то же самое:
  #   proxy_set_header Host $http_host;
  #   proxy_pass http://backend:8000/admin/;
  # }